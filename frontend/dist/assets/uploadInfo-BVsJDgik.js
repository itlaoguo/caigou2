import{d as L,r as h,a8 as O,O as R,l as V,a7 as j,h as p,c as A,o as E,a as l,w as r,x as _,v as T,a9 as W,M as f,f as q}from"./index-OLkvd68Y.js";const D={class:"main"},G=L({__name:"uploadInfo",emits:["prev","next"],setup(H,{emit:b}){var I,w,y;const g=b,U=h("file"),c=O(),k=R(),S=h(),C=V(()=>({Authorization:`Bearer ${k.token||""}`})),i=h([]),M={},t=j({file:((I=c.uploadInfo)==null?void 0:I.file)||"",path:((w=c.uploadInfo)==null?void 0:w.path)||"",url:((y=c.uploadInfo)==null?void 0:y.url)||""}),x=()=>{g("prev")},B=e=>e&&e.code?e.code===1e4?e.data:{error:e.message||"上传失败",code:e.code}:e&&e.data?e.data:e,F=e=>{var a,o;if((a=e==null?void 0:e.response)!=null&&a.error){const s=e.response.error||"上传失败";if(f.error(s),e.response.code===10001?f.warning("认证失败，请重新登录"):e.response.code===10003&&f.warning("没有权限操作"),e.file){const n=i.value.findIndex(u=>{var d;return u.name===((d=e.file)==null?void 0:d.name)});n>-1&&i.value.splice(n,1)}return}if((o=e==null?void 0:e.response)!=null&&o.data||e!=null&&e.response){const s=e.response.data||e.response,n={path:s.path||s.filename||"",url:s.url||s.path||"",file:s.filename||s.path||""};if(Object.assign(t,n),c.setUploadInfo(n),n.path||n.url){const u=n.url||n.path;i.value=[{name:u.split("/").pop()||"已上传文件",url:u,status:"success"}]}}},N=e=>{var s,n,u,d;const a=((s=e.response)==null?void 0:s.error)||((n=e.response)==null?void 0:n.message)||"文件上传失败";f.error(`文件 ${e.file.name} 上传失败：${a}`),((u=e.response)==null?void 0:u.code)===10001?f.warning("认证失败，请重新登录"):((d=e.response)==null?void 0:d.code)===10003&&f.warning("没有权限操作");const o=i.value.findIndex(m=>m.name===e.file.name);o>-1&&i.value.splice(o,1)},v=async()=>{const e=t.path||t.url||t.file,a=i.value.length>0&&i.value.some(o=>o.status==="success");if(!e&&!a){f.warning("请先上传采购商品excel文件");return}if(!e&&a){const o=i.value.find(s=>s.status==="success");o!=null&&o.url&&(t.url=o.url,t.path=o.url,t.file=o.name||"")}t.path||t.url||t.file?(c.setUploadInfo({...t}),g("next")):f.warning("请先上传采购商品excel文件")};return(e,a)=>{const o=p("t-upload"),s=p("t-space"),n=p("t-form-item"),u=p("t-typography-text"),d=p("t-link"),m=p("t-button"),P=p("t-form"),$=p("t-col"),z=p("t-row");return E(),A("div",D,[l(z,null,{default:r(()=>[l($,{span:12},{default:r(()=>[l(P,{ref_key:"form",ref:S,data:t,rules:M,"label-align":"right",labelWidth:"180px",onSubmit:v},{default:r(()=>[l(n,{label:"上传采购商品excel文件",name:"file"},{default:r(()=>[l(s,null,{default:r(()=>[l(o,{files:i.value,autoUpload:"",theme:U.value,draggable:"",multiple:!1,action:"http://caigou2.yuanmapai.net.local/api/upload/file","format-response":B,headers:C.value,onSuccess:F,onFail:N},null,8,["files","theme","headers"])]),_:1})]),_:1}),l(n,{label:""},{default:r(()=>[l(u,{theme:"secondary"},{default:r(()=>a[0]||(a[0]=[_("请使用下载的模版填写采购商品excel文件  ")])),_:1}),l(d,{theme:"primary",underline:"",download:"",href:"http://caigou2.yuanmapai.net.local/uploads/purchase-template.xlsx",target:"_self"},{"prefix-icon":r(()=>[l(T(W),{name:"download",size:"16"})]),default:r(()=>[a[1]||(a[1]=_(" 下载采购商品excel模版 "))]),_:1})]),_:1}),l(n,null,{default:r(()=>[l(m,{theme:"primary",onClick:x},{default:r(()=>a[2]||(a[2]=[_("上一步")])),_:1}),l(m,{theme:"primary",onClick:v},{default:r(()=>a[3]||(a[3]=[_("下一步")])),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})])}}}),K=q(G,[["__scopeId","data-v-3cb153de"]]);export{K as default};
