import q from"./detail-CeGS1kWY.js";import{$ as E,d as M,u as O,r as d,j as s,l as W,X,g as G,h as r,c as _,o as h,b as L,a as t,w as o,v as u,x as v,t as p,f as H}from"./index-OLkvd68Y.js";import{j as J}from"./index-DiCg25Uy.js";function Q(){return E.get({url:"/base/platform/all"})}const Y={class:"list-common-table"},Z={class:"form-item-content"},ee={class:"table-container"},te={key:0},ae={key:2},le={name:"customerList"},oe=M({...le,setup(se){const P=O(),a=d({name:"",platform:"",page:1,pageSize:20,sortBy:"created_at",descending:!0}),k=async()=>{a.value={name:"",email:"",telephone:"",platform:"",page:1,pageSize:20,sortBy:"created_at",descending:!0},await f(a.value)},V=async()=>{i.value=!0,await f(a.value),i.value=!1},z=async e=>{e&&!Array.isArray(e)&&(a.value={...a.value,sortBy:e.sortBy,descending:e.descending},await f(a.value))},y=d([]),D=async()=>{i.value=!0;try{const e=await Q();e.code===1e4&&e.data&&e.data.length>0&&e.data.forEach(l=>{y.value.push({label:l.name,value:l.code})})}catch{}finally{i.value=!1}},B=[{colKey:"serial-number",width:64,fixed:"left"},{title:s("pages.customerList.table.email"),align:"left",width:320,colKey:"email",fixed:"left"},{title:s("pages.customerList.table.telephone"),align:"left",width:320,colKey:"telephone",fixed:"left"},{title:s("pages.customerList.table.createdAt"),width:160,ellipsis:!0,colKey:"created_at",sorter:!0},{title:s("pages.customerList.table.updatedAt"),align:"left",fixed:"right",width:160,colKey:"updated_at",sorter:!0},{title:s("pages.customerList.table.operate"),align:"left",fixed:"right",width:160,colKey:"op"}],F="index",K=W(()=>({offsetTop:P.isUseTabsRouter?48:0,container:`.${X}-layout`})),i=d(!1),A=d([]),x=d([]),b=d({defaultPageSize:20,total:0,defaultCurrent:1}),T=async(e,l)=>{a.value={...a.value,page:e.current,pageSize:e.pageSize},await f(a.value)},c=d(null),I=async e=>{c.value.customerDetailVisible=!0,c.value.customerId=e.row.id,c.value.getCustomer(e.row.id),c.value.getCustomerPlatforms({customerId:e.row.id,page:1,pageSize:5}),c.value.getCustomerOrders({customerId:e.row.id,page:1,pageSize:5}),c.value.getCustomerShippingAddresses({customerId:e.row.id,page:1,pageSize:5}),c.value.getCustomerPurchasedProducts({customerId:e.row.id,page:1,pageSize:5})},f=async e=>{i.value=!0;try{const l=await J(e);x.value=l.data.items,b.value={defaultPageSize:l.data.pageSize,total:l.data.total,defaultCurrent:l.data.currentPage}}catch{}finally{i.value=!1}};return G(()=>{i.value=!0,Promise.all([D(),f(a.value)]).then(()=>{i.value=!1})}),(e,l)=>{const w=r("t-input"),g=r("t-form-item"),m=r("t-col"),R=r("t-select"),C=r("t-button"),S=r("t-row"),U=r("t-form"),N=r("t-link"),$=r("t-space"),j=r("t-table");return h(),_("div",Y,[L("div",Z,[t(U,{ref:"form",data:a.value,"label-width":80,colon:"",onReset:k,onSubmit:V},{default:o(()=>[t(S,null,{default:o(()=>[t(m,{span:12},{default:o(()=>[t(S,{gutter:[24,24]},{default:o(()=>[t(m,{xxl:2,xl:3,xs:6},{default:o(()=>[t(g,{label:u(s)("pages.customerList.filterForm.email"),name:"email"},{default:o(()=>[t(w,{modelValue:a.value.email,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.email=n),type:"search",placeholder:u(s)("pages.customerList.filterForm.emailPlaceholder"),style:{minWidth:"134px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{xxl:2,xl:3,xs:6},{default:o(()=>[t(g,{label:u(s)("pages.customerList.filterForm.telephone"),name:"telephone"},{default:o(()=>[t(w,{modelValue:a.value.telephone,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.telephone=n),type:"search",placeholder:u(s)("pages.customerList.filterForm.telephonePlaceholder"),style:{minWidth:"134px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{xxl:2,xl:3,xs:6},{default:o(()=>[t(g,{label:u(s)("pages.customerList.filterForm.platform"),name:"platform"},{default:o(()=>[t(R,{modelValue:a.value.platform,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.platform=n),style:{display:"inline-block"},options:y.value,placeholder:u(s)("pages.customerList.filterForm.platformPlaceholder"),clearable:""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{xxl:4,xl:1,xs:0}),t(m,{xxl:2,xl:2,xs:6,class:"operation-container"},{default:o(()=>[t(C,{theme:"primary",type:"submit",style:{marginLeft:"var(--td-comp-margin-s)"}},{default:o(()=>[v(p(u(s)("components.commonTable.query")),1)]),_:1}),t(C,{type:"reset",variant:"base",theme:"default"},{default:o(()=>[v(p(u(s)("components.commonTable.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data"]),L("div",ee,[t(j,{data:x.value,"hide-sort-tips":!0,columns:B,"row-keys":F,pagination:b.value,onSortChange:z,"selected-row-keys":A.value,hover:!0,loading:i.value,"header-affixed-top":K.value,onPageChange:T},{account:o(({row:n})=>[n.email.length>0&&n.telephone.length>0?(h(),_("div",te,p(n.email)+" | "+p(n.telephone),1)):(h(),_("div",ae,p(n.telephone),1))]),op:o(n=>[t($,null,{default:o(()=>[t(N,{theme:"primary",onClick:ne=>I(n)},{default:o(()=>[v(p(u(s)("pages.listBase.detail")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","pagination","selected-row-keys","loading","header-affixed-top"])]),t(q,{ref_key:"customerDetailRef",ref:c},null,512)])])}}}),ce=H(oe,[["__scopeId","data-v-e23e8144"]]);export{ce as default};
