import{d as P,r as n,g as Q,h as u,c as W,o as V,a as l,w as s,b as r,e as A,x as _,t as L,v as B,j as F}from"./index-OLkvd68Y.js";import{M as Y}from"./menu-CDRUEs78.js";import{R as Z,a as $,b as ee,c as te}from"./role-CdFYx5h5.js";import{b as ae}from"./public-CddGFI_6.js";const le={style:{display:"flex","flex-direction":"column",width:"100%"}},oe={style:{display:"flex","margin-bottom":"10px","margin-left":"5px"}},ne={style:{border:"1px solid #ccc",width:"100%","border-radius":"5px",padding:"4px"}},se={class:"form-submit-container"},ie={class:"form-submit-sub"},de={class:"form-submit-left"},ue={name:"systemaccountAdd"},ve=P({...ue,props:{fetchData:{type:Function}},setup(T,{expose:I}){const M=T,h=n("无父级"),x=n(null),t=n({role_name:"",identify:"",description:"",parent_id:0,permissions:[]}),S={parent_id:[{required:!0,message:"必填",type:"warning"}],role_name:[{required:!0,message:"必填",type:"warning"}],identify:[{required:!0,message:"必填",type:"warning"}]};Q(()=>{U()});const k=n([]),q=async()=>{const o=await Z({});o.code==1e4&&(k.value=o.data)};n(null);const w=()=>{x.value.reset(),t.value.id&&(t.value.id=null,delete t.value.id),m.value=[],p.value=!1,v.value=!1,t.value},C=()=>{w(),y()},E=async o=>{const e=await $(o);e.code==1e4&&(t.value=e.data,m.value=e.data.permissions)},N=async o=>{if(o.validateResult===!0){f.value,t.value.permissions=m.value,t.value;let e=null;t.value.id?e=await ee(t.value,t.value.id):e=await te(t.value),e.code==1e4&&(y(),C(),U(),M.fetchData())}},j=n(null),m=n([]),U=async()=>{const o=await Y({});c.value=ae(o.data),c.value},c=n([{id:"1",name:"董事长-总经办",no:"1",status:"0",children:[{id:"11",name:"会计出纳-财务部",no:"1",status:"0"},{id:"12",name:"副总经理(程总) - 运营中心(程总)",no:"2",status:"0",children:[{id:"22",name:"教学 - 教培部(liliting)",no:"2",status:"0"},{id:"23",name:"校研 - 教培部",no:"2",status:"0"}]},{id:"13",name:"总经理 - 管理中心(徐总)",no:"3",status:"0",children:[{id:"24",name:"仓库主管 - 仓储部(XiaoMeiJiao)",no:"2",status:"0"},{id:"25",name:"采购主管 - 采购部(DengLiHui)",no:"2",status:"0"},{id:"26",name:"生产部主管 - 生管部",no:"2",status:"0"},{id:"27",name:"生产部主管 - 生产部",no:"2",status:"0"}]},{id:"14",name:"财务主管 - 财务部",no:"3",status:"0"},{id:"15",name:"成本会计 - 财务部",no:"3",status:"0"},{id:"16",name:"内控专员 - 财务部",no:"3",status:"0"}]}]),H=(o,e)=>{console.info("onChange checked:",o,"context:",e);const{node:i}=e;console.info(i.value,"onChange context.node.checked:",i.checked)},p=n(!1),J=()=>{p.value,m.value=p.value?g(c.value):[]},g=o=>{let e=[];return o.forEach(i=>{var d;e.push(i.id),(d=i.children)!=null&&d.length&&e.push(...g(i.children))}),e},v=n(!1),f=n([]),K=()=>{v.value,v.value?f.value=g(c.value):f.value=[]},b=n(!1),y=()=>{b.value=!b.value};return I({onSwticher:y,getitemId:E,getRoleList:q,FormData:t}),(o,e)=>{const i=u("t-input"),d=u("t-form-item"),X=u("t-tree-select"),R=u("t-checkbox"),z=u("t-tree"),D=u("t-button"),G=u("t-form"),O=u("t-dialog");return V(),W("div",null,[l(O,{visible:b.value,"onUpdate:visible":e[9]||(e[9]=a=>b.value=a),header:"角色添加",width:"600",footer:!1,onClose:w},{default:s(()=>[r("div",null,[l(G,{ref_key:"Form",ref:x,rules:S,data:t.value,"label-align":"right","label-width":100,onSubmit:N,onReset:C},{default:s(()=>[t.value.parent_id==0?(V(),A(d,{key:0,label:"父级节点",name:"permission_name"},{default:s(()=>[l(i,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a)},null,8,["modelValue"])]),_:1})):(V(),A(d,{key:1,label:"父级节点",name:"parent_id"},{default:s(()=>[l(X,{modelValue:t.value.parent_id,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.parent_id=a),data:k.value,clearable:"",filterable:"",placeholder:"请选择","tree-props":{checkStrictly:!0,keys:{value:"id",label:"role_name",children:"children"}}},null,8,["modelValue","data"])]),_:1})),l(d,{label:"角色名称",name:"role_name"},{default:s(()=>[l(i,{modelValue:t.value.role_name,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.role_name=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"角色标识",name:"identify"},{default:s(()=>[l(i,{modelValue:t.value.identify,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.identify=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"角色描述",name:"description"},{default:s(()=>[l(i,{modelValue:t.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.description=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"角色权限",style:{width:"100%"}},{default:s(()=>[r("div",le,[r("div",oe,[l(R,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),onChange:K,style:{"margin-right":"20px"}},{default:s(()=>e[10]||(e[10]=[_("展开")])),_:1},8,["modelValue"]),e[12]||(e[12]=_()),l(R,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a),onChange:J},{default:s(()=>e[11]||(e[11]=[_("全选")])),_:1},8,["modelValue"])]),r("div",ne,[l(z,{ref_key:"Tree",ref:j,expanded:f.value,"onUpdate:expanded":e[7]||(e[7]=a=>f.value=a),"expand-on-click-node":!1,"check-strictly":!0,data:c.value,activable:"",hover:"",transition:"",modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=a=>m.value=a),checkable:"",keys:{value:"id",label:"permission_name",children:"children"},onChange:H},null,8,["expanded","data","modelValue"])])])]),_:1}),r("div",se,[r("div",ie,[r("div",de,[l(D,{theme:"primary",class:"form-submit-confirm",type:"submit"},{default:s(()=>[_(L(B(F)("pages.formBase.confirm")),1)]),_:1}),l(D,{type:"reset",class:"form-submit-cancel",theme:"default",variant:"base"},{default:s(()=>[_(L(B(F)("pages.formBase.cancel")),1)]),_:1})])])])]),_:1},8,["data"])])]),_:1},8,["visible"])])}}});export{ve as _};
