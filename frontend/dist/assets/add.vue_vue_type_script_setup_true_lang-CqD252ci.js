import{$ as _,d as H,r,g as J,h as d,c as O,o as B,a,w as s,b as c,e as Q,E as W,x as v,t as $,v as E,j as R}from"./index-OLkvd68Y.js";import{R as X}from"./role-CdFYx5h5.js";function me(n){return _.get({url:"/users",params:n})}function Y(n){return _.post({url:"/users",data:n})}function ee(n){return _.get({url:`/users/${n}`})}function ce(n){return _.delete({url:`/users/${n}`})}function te(n,x){return _.put({url:`/users/${x}`,data:n})}const ae={style:{display:"flex","flex-direction":"column",width:"100%"}},le={style:{display:"flex","margin-bottom":"10px","margin-left":"5px"}},oe={style:{border:"1px solid #ccc",width:"100%","border-radius":"5px",padding:"4px"}},se={class:"form-submit-container"},ne={class:"form-submit-sub"},ue={class:"form-submit-left"},re={name:"systemaccountAdd"},ve=H({...re,props:{fetchData:{type:Function}},setup(n,{expose:x}){const z=n,t=r({username:"",email:"",password:"",status:1,roles:[]}),w=r(null),A=()=>{w.value.reset(),t.value.id&&(t.value.id=null,delete t.value.id),i.value=[],p.value=!1,g.value=!1,t.value},k=()=>{A(),h()},N=l=>{t.value.status=l,t.value},P=async l=>{const e=await ee(l);e.code==1e4&&(t.value=e.data,i.value=e.data.roles)},T=async l=>{if(t.value,l.validateResult===!0){i.value,t.value.roles=i.value,t.value;let e=null;t.value.id?e=await te(t.value,t.value.id):e=await Y(t.value),e.code==1e4&&(h(),k(),C(),z.fetchData())}},Z=r(null),i=r([]),C=async()=>{const l=await X({});f.value=l.data,f.value};J(()=>{C()});const f=r([]),F=(l,e)=>{console.info("onChange checked:",l,"context:",e);const{node:u}=e;console.info(u.value,"onChange context.node.checked:",u.checked),i.value},p=r(!1),I=()=>{p.value,i.value=p.value?V(f.value):[]},V=l=>{let e=[];return l.forEach(u=>{var m;e.push(u.id),(m=u.children)!=null&&m.length&&e.push(...V(u.children))}),e},g=r(!1),b=r([]),S=()=>{g.value,g.value?b.value=V(f.value):b.value=[]},K={username:[{required:!0,message:"必填",type:"error"}],email:[{required:!0,message:"必填",type:"error"},{validator:l=>/^[a-zA-Z0-9_.%+-]+@[a-zA-Z0-9-]+\.[a-zA-Z]{2,}$/.test(l),message:"请输入正确的邮箱格式（如：user@qq.com）",type:"error"}],status:[{required:!0,message:"必填",type:"error"}],password:[{required:!0,message:"必填",type:"error"},{validator:l=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/.test(l),message:"密码需包含大小写字母和数字，且至少6位",type:"error"}]},y=r(!1),h=()=>{y.value=!y.value};return x({onSwticher:h,getitemId:P}),(l,e)=>{const u=d("t-input"),m=d("t-form-item"),U=d("t-radio"),L=d("t-radio-group"),q=d("t-checkbox"),j=d("t-tree"),D=d("t-button"),M=d("t-form"),G=d("t-dialog");return B(),O("div",null,[a(G,{visible:y.value,"onUpdate:visible":e[7]||(e[7]=o=>y.value=o),header:"账号添加",width:"600",footer:!1,onClose:A},{default:s(()=>[c("div",null,[a(M,{ref_key:"form",ref:w,rules:K,data:t.value,"label-align":"right","label-width":100,onSubmit:T,onReset:k},{default:s(()=>[a(m,{label:"用户名",name:"username"},{default:s(()=>[a(u,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.username=o)},null,8,["modelValue"])]),_:1}),a(m,{label:"邮箱号码",name:"email"},{default:s(()=>[a(u,{modelValue:t.value.email,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.email=o)},null,8,["modelValue"])]),_:1}),t.value.id?W("",!0):(B(),Q(m,{key:0,label:"用户密码",name:"password"},{default:s(()=>[a(u,{modelValue:t.value.password,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.password=o)},null,8,["modelValue"])]),_:1})),a(m,{label:"状态",name:"status"},{default:s(()=>[a(L,{value:t.value.status,onChange:N},{default:s(()=>[a(U,{value:1},{default:s(()=>e[8]||(e[8]=[v("开启")])),_:1}),a(U,{value:2},{default:s(()=>e[9]||(e[9]=[v("关闭")])),_:1})]),_:1},8,["value"])]),_:1}),a(m,{label:"角色权限",style:{width:"100%"}},{default:s(()=>[c("div",ae,[c("div",le,[a(q,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),onChange:S,style:{"margin-right":"20px"}},{default:s(()=>e[10]||(e[10]=[v("展开")])),_:1},8,["modelValue"]),e[12]||(e[12]=v()),a(q,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),onChange:I},{default:s(()=>e[11]||(e[11]=[v("全选")])),_:1},8,["modelValue"])]),c("div",oe,[a(j,{ref_key:"Tree",ref:Z,expanded:b.value,"onUpdate:expanded":e[5]||(e[5]=o=>b.value=o),"expand-on-click-node":!1,data:f.value,activable:"",hover:"",transition:"",modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value=o),checkable:"",keys:{value:"id",label:"role_name",children:"children"},onChange:F},null,8,["expanded","data","modelValue"])])])]),_:1}),c("div",se,[c("div",ne,[c("div",ue,[a(D,{theme:"primary",class:"form-submit-confirm",type:"submit"},{default:s(()=>[v($(E(R)("pages.formBase.confirm")),1)]),_:1}),a(D,{type:"reset",class:"form-submit-cancel",theme:"default",variant:"base"},{default:s(()=>[v($(E(R)("pages.formBase.cancel")),1)]),_:1})])])])]),_:1},8,["data"])])]),_:1},8,["visible"])])}}});export{me as A,ve as _,ce as a};
